<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Türkçe Wordle Oyunu</title>
    <style>
        :root {
            --green: #6aaa64;
            --yellow: #c9b458;
            --grey: #787c7e;
            --dark: #121213;
            --light: #ffffff;
            --border: #3a3a3c;
            --key-bg: #818384;
        }

        body {
            background-color: var(--dark);
            color: var(--light);
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between; /* Alanı dikeyde yay */
            margin: 0;
            height: 100vh; /* Tam ekran yüksekliği */
            overflow: hidden; /* Kaydırmayı engelle */
            touch-action: manipulation; /* Çift tıklama zoomunu engelle */
        }

        h1 { 
            font-size: 1.5rem;
            margin: 10px 0 5px 0; 
            border-bottom: 1px solid var(--border); 
            padding-bottom: 5px; 
        }
        
        .info-bar { 
            text-align: center; 
            font-size: 0.8rem;
        }
        .info-bar p { margin: 2px; color: #aaa; }

        #game-board {
            display: grid;
            grid-gap: 5px;
            margin: 10px 0;
            flex-grow: 1; /* Boş alanı kapla */
            align-content: center; /* Dikeyde ortala */
            overflow-y: auto;
        }

        .tile {
            /* Mobilde ekran boyutuna göre esnek kareler */
            width: 13vw; 
            height: 13vw;
            max-width: 50px;
            max-height: 50px;
            border: 2px solid var(--border);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        /* Renk Sınıfları */
        .correct { background-color: var(--green); border-color: var(--green); }
        .present { background-color: var(--yellow); border-color: var(--yellow); }
        .absent { background-color: var(--grey); border-color: var(--grey); }
        .filled { border-color: #565758; }

        /* Mesaj Alanı */
        #message-area {
            position: fixed;
            top: 10%;
            background-color: rgba(255, 255, 255, 0.95);
            color: black;
            padding: 15px 25px;
            border-radius: 5px;
            font-weight: bold;
            display: none;
            z-index: 20;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            font-size: 1.1rem;
        }

        button#restart-btn {
            padding: 12px 24px;
            background-color: var(--green);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            display: none;
            margin-bottom: 10px;
            border-radius: 4px;
        }

        /* --- SANAL KLAVYE STİLLERİ --- */
        #keyboard-cont {
            width: 100%;
            max-width: 500px;
            margin-bottom: 10px;
            padding: 0 3px;
            box-sizing: border-box;
        }

        .keyboard-row {
            display: flex;
            width: 100%;
            margin: 0 auto 8px;
            touch-action: manipulation;
            justify-content: center;
        }

        .keyboard-button {
            font-family: inherit;
            font-weight: bold;
            border: 0;
            padding: 0;
            margin: 0 2px; /* Tuşlar arası boşluk */
            height: 55px; /* Tuş yüksekliği */
            border-radius: 4px;
            cursor: pointer;
            user-select: none;
            background-color: var(--key-bg);
            color: var(--light);
            flex: 1; /* Tuşlar eşit dağılsın */
            display: flex;
            justify-content: center;
            align-items: center;
            text-transform: uppercase;
            font-size: 0.85rem; /* Harf boyutu */
        }

        /* Enter ve Sil tuşlarını biraz daha geniş yap */
        .keyboard-button.wide-button {
            flex: 1.5;
            font-size: 0.75rem;
        }
        
        /* Renklendirilmiş Klavye Tuşları */
        .key-correct { background-color: var(--green) !important; transition: 0.3s; }
        .key-present { background-color: var(--yellow) !important; transition: 0.3s; }
        .key-absent { background-color: #3a3a3c !important; transition: 0.3s; }

    </style>
</head>
<body>

    <h1>KELİME BULMACA</h1>
    
    <div class="info-bar">
        <p id="level-info">LEVEL: 1 (3 HARFLİ)</p>
        <p id="category-info">KATEGORİ: HAYVAN</p>
        <p id="stamina-info">HAK: 4</p>
    </div>

    <div id="message-area"></div>

    <div id="game-board">
        </div>

    <button id="restart-btn" onclick="nextLevelOrRestart()">Sonraki Seviye / Tekrar Oyna</button>

    <div id="keyboard-cont"></div>

    <script>
        // --- AYARLAR VE KELİME HAVUZU ---
        const GAME_DATA = {
            3: { 
                category: "HAYVAN", 
                words: ["KUS", "AYI", "ARI", "FIL", "FOK", "KAZ", "BIT", "KOC"] 
            },
            4: { 
                category: "ULKE", 
                words: ["IRAN", "IRAK", "KUBA", "PERU", "SILI", "LAOS", "MALI", "FIJI", "TOGO", "GANA", "GINE"] 
            },
            5: { 
                category: "SEHIR (TR)", 
                words: ["MUGLA", "IZMIR", "SINOP", "CORUM", "SIIRT", "SIVAS", "AYDIN", "BURSA", "DUZCE", "KILIS", "IGDIR", "TOKAT", "KONYA", "NIGDE", "ADANA", "HATAY"] 
            },
            6: { 
                category: "BITKI", 
                words: ["AKASYA", "ANASON", "ARIOTU", "CAKSIR", "KUSOTU", "GURGEN", "CAVDAR", "HUNNAP", "ANANAS", "KAMKAT", "KAYISI", "KARPUZ", "TURUNC", "MUSKAT", "ALABAS", "PANCAR", "PIRASA", "SALGAM", "HASHAS", "KISNIS", "KIMYON", "LAHANA", "MURVER", "MAHLEP", "REZENE", "SUTOTU", "SARIOT", "SIMSIR", "CIGDEM", "DISOTU", "KAKTUS", "KIZOTU", "LEYLAK", "NERGIS", "ORKIDE", "REYHAN", "ZAKKUM", "ZAMBAK", "CELTIK", "FISTIK", "FINDIK", "HARDAL", "PIRINC", "SAFRAN", "ZEYTIN", "KAKULE", "JOJOBA", "LILYUM"] 
            }
        };

        // --- GLOBAL DEĞİŞKENLER ---
        let currentTour = 3; 
        let maxAttempts = 0;
        let currentAttempt = 0;
        let targetWord = "";
        let currentGuess = "";
        let gameOver = false;
        let gameBoard = document.getElementById("game-board");

        // --- BAŞLATMA ---
        window.onload = function() {
            initKeyboard(); // Klavyeyi oluştur
            startGame(currentTour);
            
            // Fiziksel klavye desteği (PC için hala çalışsın)
            document.addEventListener("keydown", (e) => {
                if(gameOver) return;
                let key = e.key;
                if (key === "Enter") handleVirtualKey("ENTER");
                else if (key === "Backspace") handleVirtualKey("SIL");
                else if (key.length === 1 && key.match(/[a-zA-ZğüşıöçĞÜŞİÖÇ]/)) handleVirtualKey(key.toLocaleUpperCase('tr-TR'));
            });
        };

        // --- SANAL KLAVYE OLUŞTURMA ---
        function initKeyboard() {
            const keys = [
                "E R T Y U I O P Ğ Ü",
                "A S D F G H J K L Ş İ",
                "ENTER Z X C V B N M Ö Ç SIL"
            ];
            
            const keyboardCont = document.getElementById("keyboard-cont");
            keyboardCont.innerHTML = ""; // Temizle

            keys.forEach(rowString => {
                let rowDiv = document.createElement("div");
                rowDiv.classList.add("keyboard-row");
                
                let chars = rowString.split(" ");
                
                chars.forEach(char => {
                    let btn = document.createElement("button");
                    btn.classList.add("keyboard-button");
                    btn.innerText = char;
                    btn.setAttribute("data-key", char); // Renk değişimi için referans

                    if(char === "ENTER" || char === "SIL") {
                        btn.classList.add("wide-button");
                    }

                    // Tıklama olayı
                    btn.addEventListener("click", () => {
                        handleVirtualKey(char);
                    });

                    rowDiv.appendChild(btn);
                });

                keyboardCont.appendChild(rowDiv);
            });
        }

        // --- TUŞ İŞLEMLERİ ---
        function handleVirtualKey(key) {
            if (gameOver) return;

            if (key === "ENTER") {
                submitGuess();
            } else if (key === "SIL") {
                if(currentGuess.length > 0) {
                    currentGuess = currentGuess.slice(0, -1);
                    updateActiveRow();
                }
            } else {
                // Harf ekleme
                if (currentGuess.length < currentTour) {
                    currentGuess += key;
                    updateActiveRow();
                }
            }
        }

        function startGame(tour) {
            if (tour > 6) {
                showMessage("TEBRİKLER! TÜM SEVİYELERİ BİTİRDİNİZ.", 5000);
                document.getElementById("restart-btn").style.display = "none";
                return;
            }

            // Değişkenleri sıfırla
            currentTour = tour;
            currentAttempt = 0;
            currentGuess = "";
            gameOver = false;
            maxAttempts = tour + 1;
            
            // Kelime seç
            const words = GAME_DATA[tour].words;
            targetWord = words[Math.floor(Math.random() * words.length)];
            console.log("Hedef Kelime (Hile):", targetWord);

            // Arayüzü güncelle
            document.getElementById("level-info").innerText = `LEVEL: ${tour - 2} (${tour} HARFLİ)`;
            document.getElementById("category-info").innerText = `KATEGORİ: ${GAME_DATA[tour].category}`;
            document.getElementById("stamina-info").innerText = `HAK: ${maxAttempts}`;
            document.getElementById("restart-btn").style.display = "none";

            createBoard(tour, maxAttempts);
            resetKeyboardColors(); // Yeni oyunda klavye renklerini sıfırla
        }

        function createBoard(width, height) {
            gameBoard.style.gridTemplateColumns = `repeat(${width}, 14vw)`; // Mobilde esnek genişlik
            if (window.innerWidth > 500) { // PC ekranında sabit kalsın
                gameBoard.style.gridTemplateColumns = `repeat(${width}, 50px)`;
            }
            
            gameBoard.innerHTML = "";

            for (let i = 0; i < height * width; i++) {
                let box = document.createElement("div");
                box.classList.add("tile");
                box.id = `box-${i}`;
                gameBoard.appendChild(box);
            }
        }

        function updateActiveRow() {
            let rowStart = currentAttempt * currentTour;
            for (let i = 0; i < currentTour; i++) {
                let box = document.getElementById(`box-${rowStart + i}`);
                box.innerText = currentGuess[i] || "";
                
                if (currentGuess[i]) {
                    box.classList.add("filled");
                } else {
                    box.classList.remove("filled");
                }
            }
        }

        function submitGuess() {
            if (currentGuess.length !== currentTour) {
                showMessage("Yetersiz harf sayısı!");
                return;
            }

            const guessResult = checkGuess(currentGuess, targetWord);
            colorizeRow(guessResult);
            updateKeyboardColors(currentGuess, guessResult); // Klavye renklerini güncelle

            if (currentGuess === targetWord) {
                showMessage(`Bravo.. ${currentAttempt + 1} denemede bildiniz!`);
                gameOver = true;
                document.getElementById("restart-btn").style.display = "block";
                document.getElementById("restart-btn").innerText = "Sonraki Seviye";
            } else {
                currentAttempt++;
                currentGuess = "";
                document.getElementById("stamina-info").innerText = `KALAN HAK: ${maxAttempts - currentAttempt}`;

                if (currentAttempt >= maxAttempts) {
                    showMessage(`Kaybettin! Doğru Kelime: ${targetWord}`);
                    gameOver = true;
                    document.getElementById("restart-btn").style.display = "block";
                    document.getElementById("restart-btn").innerText = "Tekrar Dene";
                }
            }
        }

        // --- RENK ALGORİTMASI ---
        function checkGuess(guess, target) {
            let result = new Array(guess.length).fill(0); // 0: Gri, 1: Yeşil, 2: Sarı
            let targetFreq = {};
            
            for (let char of target) {
                targetFreq[char] = (targetFreq[char] || 0) + 1;
            }

            // 1. Aşama: Yeşiller
            for (let i = 0; i < guess.length; i++) {
                if (guess[i] === target[i]) {
                    result[i] = 1; 
                    targetFreq[guess[i]]--;
                }
            }

            // 2. Aşama: Sarılar
            for (let i = 0; i < guess.length; i++) {
                if (result[i] === 0) { 
                    if (targetFreq[guess[i]] > 0) {
                        result[i] = 2; 
                        targetFreq[guess[i]]--;
                    }
                }
            }
            return result;
        }

        function colorizeRow(resultArray) {
            let rowStart = currentAttempt * currentTour;
            for (let i = 0; i < currentTour; i++) {
                let box = document.getElementById(`box-${rowStart + i}`);
                
                // Animasyon efekti için kısa gecikme eklenebilir
                if (resultArray[i] === 1) box.classList.add("correct");
                else if (resultArray[i] === 2) box.classList.add("present");
                else box.classList.add("absent");
            }
        }

        // --- KLAVYE RENK GÜNCELLEME ---
        function updateKeyboardColors(guess, result) {
            for (let i = 0; i < guess.length; i++) {
                let char = guess[i];
                let colorStatus = result[i]; // 1: Yeşil, 2: Sarı, 0: Gri
                
                let keyBtn = document.querySelector(`button[data-key='${char}']`);
                if (!keyBtn) continue;

                // Yeşil varsa diğerlerini ezmeli
                if (colorStatus === 1) {
                    keyBtn.classList.remove("key-present");
                    keyBtn.classList.add("key-correct");
                } 
                // Sarı varsa ve henüz Yeşil değilse
                else if (colorStatus === 2 && !keyBtn.classList.contains("key-correct")) {
                    keyBtn.classList.add("key-present");
                } 
                // Gri ise ve ne Yeşil ne Sarıysa
                else if (colorStatus === 0 && !keyBtn.classList.contains("key-correct") && !keyBtn.classList.contains("key-present")) {
                    keyBtn.classList.add("key-absent");
                }
            }
        }

        function resetKeyboardColors() {
            let keys = document.querySelectorAll(".keyboard-button");
            keys.forEach(k => {
                k.classList.remove("key-correct", "key-present", "key-absent");
            });
        }

        function showMessage(msg, duration = 3000) {
            const el = document.getElementById("message-area");
            el.innerText = msg;
            el.style.display = "block";
            
            if (!gameOver) {
                setTimeout(() => {
                    el.style.display = "none";
                }, duration);
            }
        }

        function nextLevelOrRestart() {
            const btnText = document.getElementById("restart-btn").innerText;
            if (btnText === "Sonraki Seviye") {
                currentTour++;
                startGame(currentTour);
            } else {
                startGame(currentTour);
            }
        }
    </script>
</body>
</html>
