<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Türkçe Wordle Oyunu</title>
    <style>
        :root {
            --green: #6aaa64;
            --yellow: #c9b458;
            --grey: #787c7e;
            --dark: #121213;
            --light: #ffffff;
            --border: #3a3a3c;
        }

        body {
            background-color: var(--dark);
            color: var(--light);
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            min-height: 100vh;
        }

        h1 { margin-bottom: 10px; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
        
        .info-bar { margin-bottom: 20px; text-align: center; }
        .info-bar p { margin: 5px; color: #aaa; }

        #game-board {
            display: grid;
            grid-gap: 5px;
            margin-bottom: 20px;
        }

        .tile {
            width: 50px;
            height: 50px;
            border: 2px solid var(--border);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        /* Renk Sınıfları */
        .correct { background-color: var(--green); border-color: var(--green); }
        .present { background-color: var(--yellow); border-color: var(--yellow); }
        .absent { background-color: var(--grey); border-color: var(--grey); }
        .filled { border-color: #565758; }

        /* Mesaj Alanı */
        #message-area {
            position: fixed;
            top: 10%;
            background-color: rgba(255, 255, 255, 0.9);
            color: black;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            display: none;
            z-index: 10;
        }

        /* Input Alanı (Gizli ama odaklı) */
        #hidden-input {
            opacity: 0;
            position: absolute;
            top: -1000px;
        }

        .keyboard-hint {
            color: #888;
            font-size: 0.9rem;
            margin-top: 10px;
        }
        
        button#restart-btn {
            padding: 10px 20px;
            background-color: var(--green);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            display: none;
            margin-top: 10px;
        }
    </style>
</head>
<body>

    <h1>KELİME BULMACA</h1>
    
    <div class="info-bar">
        <p id="level-info">LEVEL: 1 (3 HARFLİ)</p>
        <p id="category-info">KATEGORİ: HAYVAN</p>
        <p id="stamina-info">HAK: 4</p>
    </div>

    <div id="message-area"></div>

    <div id="game-board">
        </div>

    <button id="restart-btn" onclick="nextLevelOrRestart()">Sonraki Seviye / Tekrar Oyna</button>
    <div class="keyboard-hint">Klavye ile yazın ve ENTER tuşuna basın.</div>

    <input type="text" id="hidden-input" autocomplete="off">

    <script>
        // --- AYARLAR VE KELİME HAVUZU (Dosya Okuma Yerine) ---
        // C kodundaki 'seviyeX.txt' dosyalarının yerini bu nesne alıyor.
        const GAME_DATA = {
            3: { category: "HAYVAN", words: ["AYI", "KUS", "FIL", "AT", "KOC", "ARI"] },
            4: { category: "ULKE", words: ["IRAK", "IRAN", "GINE", "MALI", "PERU"] },
            5: { category: "SEHIR (TR)", words: ["IZMIR", "SIVAS", "BURSA", "ADANA", "HATAY"] },
            6: { category: "BITKI", words: ["KAKTUS", "ZAMBAK", "MIMOZA", "FESLEGE"] }
        };

        // --- GLOBAL DEĞİŞKENLER ---
        let currentTour = 3; // Başlangıç seviyesi (Harf sayısı)
        let maxAttempts = 0;
        let currentAttempt = 0;
        let targetWord = "";
        let currentGuess = "";
        let gameOver = false;
        let gameBoard = document.getElementById("game-board");
        let inputField = document.getElementById("hidden-input");

        // --- BAŞLATMA ---
        window.onload = function() {
            startGame(currentTour);
            
            // Fiziksel klavye dinleyicisi
            document.addEventListener("keydown", handleKeydown);
            
            // Mobil için ekrana dokununca klavye açılması
            document.addEventListener("click", () => {
                if(!gameOver) inputField.focus();
            });
        };

        function startGame(tour) {
            // Oyun bitti mi kontrolü
            if (tour > 6) {
                showMessage("TEBRİKLER! TÜM SEVİYELERİ BİTİRDİNİZ.", 5000);
                document.getElementById("restart-btn").style.display = "none";
                return;
            }

            // Değişkenleri sıfırla
            currentTour = tour;
            currentAttempt = 0;
            currentGuess = "";
            gameOver = false;
            maxAttempts = tour + 1;
            
            // Kelime seç (C'deki random mantığı)
            const words = GAME_DATA[tour].words;
            targetWord = words[Math.floor(Math.random() * words.length)];
            console.log("Hedef Kelime (Hile):", targetWord); // Test için konsola yazar

            // Arayüzü güncelle
            document.getElementById("level-info").innerText = `LEVEL: ${tour - 2} (${tour} HARFLİ)`;
            document.getElementById("category-info").innerText = `KATEGORİ: ${GAME_DATA[tour].category}`;
            document.getElementById("stamina-info").innerText = `HAK: ${maxAttempts}`;
            document.getElementById("restart-btn").style.display = "none";

            createBoard(tour, maxAttempts);
            inputField.value = "";
            inputField.focus();
        }

        // Izgarayı oluşturma (Display fonksiyonu yerine)
        function createBoard(width, height) {
            gameBoard.style.gridTemplateColumns = `repeat(${width}, 50px)`;
            gameBoard.innerHTML = ""; // Temizle

            for (let i = 0; i < height * width; i++) {
                let box = document.createElement("div");
                box.classList.add("tile");
                box.id = `box-${i}`;
                gameBoard.appendChild(box);
            }
        }

        // --- OYUN MANTIĞI ---

        function handleKeydown(e) {
            if (gameOver) return;

            let key = e.key;

            // Türkçe karakter desteği ile Büyük Harfe çevir
            // C kodundaki 'buyukkucukayar' fonksiyonunun modern JS hali
            if (key.length === 1 && key.match(/[a-zA-ZğüşıöçĞÜŞİÖÇ]/)) {
                if (currentGuess.length < currentTour) {
                    addLetter(key.toLocaleUpperCase('tr-TR'));
                }
            } else if (key === "Backspace") {
                removeLetter();
            } else if (key === "Enter") {
                submitGuess();
            }
        }

        function addLetter(letter) {
            currentGuess += letter;
            updateActiveRow();
        }

        function removeLetter() {
            currentGuess = currentGuess.slice(0, -1);
            updateActiveRow();
        }

        function updateActiveRow() {
            let rowStart = currentAttempt * currentTour;
            // O anki satırı temizle ve yeniden yaz
            for (let i = 0; i < currentTour; i++) {
                let box = document.getElementById(`box-${rowStart + i}`);
                box.innerText = currentGuess[i] || "";
                
                if (currentGuess[i]) {
                    box.classList.add("filled");
                } else {
                    box.classList.remove("filled");
                }
            }
        }

        function submitGuess() {
            if (currentGuess.length !== currentTour) {
                showMessage("Yetersiz harf sayısı!");
                return;
            }

            // C kodundaki checkRow fonksiyonunun JS karşılığı
            const guessResult = checkGuess(currentGuess, targetWord);
            colorizeRow(guessResult);

            if (currentGuess === targetWord) {
                showMessage(`Bravo.. ${currentAttempt + 1} denemede bildiniz!`);
                gameOver = true;
                document.getElementById("restart-btn").style.display = "block";
                document.getElementById("restart-btn").innerText = "Sonraki Seviye";
            } else {
                currentAttempt++;
                currentGuess = "";
                document.getElementById("stamina-info").innerText = `KALAN HAK: ${maxAttempts - currentAttempt}`;

                if (currentAttempt >= maxAttempts) {
                    showMessage(`Kaybettin! Doğru Kelime: ${targetWord}`);
                    gameOver = true;
                    // Kaybedince başa dönmemesi için mantığı burada değiştirebilirsiniz
                    // Şimdilik C kodundaki gibi bitiriyor.
                    document.getElementById("restart-btn").style.display = "block";
                    document.getElementById("restart-btn").innerText = "Tekrar Dene";
                }
            }
        }

        // Renk Algoritması (C kodundaki frekans dizisi mantığı)
        function checkGuess(guess, target) {
            let result = new Array(guess.length).fill(0); // 0: Gri, 1: Yeşil, 2: Sarı
            let targetFreq = {};
            
            // Harf sayılarını hesapla
            for (let char of target) {
                targetFreq[char] = (targetFreq[char] || 0) + 1;
            }

            // 1. Aşama: Yeşilleri (Tam eşleşme) bul
            for (let i = 0; i < guess.length; i++) {
                if (guess[i] === target[i]) {
                    result[i] = 1; // Yeşil
                    targetFreq[guess[i]]--;
                }
            }

            // 2. Aşama: Sarıları (Yanlış yer) bul
            for (let i = 0; i < guess.length; i++) {
                if (result[i] === 0) { // Henüz yeşil değilse
                    if (targetFreq[guess[i]] > 0) {
                        result[i] = 2; // Sarı
                        targetFreq[guess[i]]--;
                    }
                }
            }
            return result;
        }

        function colorizeRow(resultArray) {
            let rowStart = currentAttempt * currentTour;
            for (let i = 0; i < currentTour; i++) {
                let box = document.getElementById(`box-${rowStart + i}`);
                // Animasyon eklenebilir, şimdilik direkt boyuyoruz
                if (resultArray[i] === 1) box.classList.add("correct");
                else if (resultArray[i] === 2) box.classList.add("present");
                else box.classList.add("absent");
            }
        }

        function showMessage(msg, duration = 3000) {
            const el = document.getElementById("message-area");
            el.innerText = msg;
            el.style.display = "block";
            
            // Eğer oyun bitmediyse mesaj kaybolsun, bittiyse kalsın
            if (!gameOver) {
                setTimeout(() => {
                    el.style.display = "none";
                }, duration);
            }
        }

        function nextLevelOrRestart() {
            const btnText = document.getElementById("restart-btn").innerText;
            if (btnText === "Sonraki Seviye") {
                currentTour++;
                startGame(currentTour);
            } else {
                // Kaybettiği seviyeden tekrar başlat
                startGame(currentTour);
            }
        }

    </script>
</body>
</html>
