<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Türkçe Wordle Oyunu</title>
    <style>
        :root {
            --green: #6aaa64;
            --yellow: #c9b458;
            --grey: #787c7e;
            --dark: #121213;
            --light: #ffffff;
            --border: #3a3a3c;
            --key-bg: #818384;
            /* Ekranın güvenli alanlarını hesapla (iPhone X ve üzeri için) */
            --safe-bottom: env(safe-area-inset-bottom, 10px);
        }

        * {
            box-sizing: border-box; /* padding hesaplamalarını sabitle */
        }

        body {
            background-color: var(--dark);
            color: var(--light);
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            
            /* EKRAN SABİTLEME SİHRİ */
            position: fixed; /* Ekranı çivile */
            width: 100%;
            height: 100%;
            height: 100dvh; /* Adres çubuğu sorununu çözer */
            overflow: hidden; /* Kaydırmayı engelle */
            overscroll-behavior: none; /* Lastik etkisini kapat */
            touch-action: none; /* Tarayıcı jestlerini kapat */
            
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* HEADER ALANI */
        header {
            width: 100%;
            border-bottom: 1px solid var(--border);
            padding: 10px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-shrink: 0; /* Küçülmesine izin verme */
        }

        h1 { 
            font-size: 1.5rem;
            margin: 0;
            letter-spacing: 2px;
        }
        
        .info-bar { 
            display: flex;
            gap: 15px;
            font-size: 0.8rem;
            margin-top: 5px;
            color: #aaa;
        }

        /* OYUN ALANI (Esnek) */
        #game-container {
            flex-grow: 1; /* Kalan tüm boşluğu kapla */
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            padding: 10px;
        }

        #game-board {
            display: grid;
            grid-gap: 5px;
            /* Maksimum genişlik ve yükseklik sınırları */
            max-width: 350px; 
            max-height: 100%;
            aspect-ratio: 5 / 6; /* Wordle tahtasının yaklaşık oranı */
        }

        .tile {
            width: 100%; /* Grid hücresini doldur */
            aspect-ratio: 1 / 1; /* Kare kalmasını sağla */
            border: 2px solid var(--border);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.8rem;
            font-weight: bold;
            text-transform: uppercase;
            user-select: none; /* Yazı seçimini engelle */
        }

        /* Renk Sınıfları */
        .correct { background-color: var(--green); border-color: var(--green); }
        .present { background-color: var(--yellow); border-color: var(--yellow); }
        .absent { background-color: var(--grey); border-color: var(--grey); }
        .filled { border-color: #888; animation: pop 0.1s; }

        @keyframes pop { 50% { transform: scale(1.1); } }

        /* Mesaj Alanı */
        #message-area {
            position: absolute;
            top: 15%;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(255, 255, 255, 0.95);
            color: black;
            padding: 15px 25px;
            border-radius: 5px;
            font-weight: bold;
            display: none;
            z-index: 50;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            font-size: 1rem;
            text-align: center;
            white-space: nowrap;
        }

        button#restart-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 15px 30px;
            background-color: var(--green);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: bold;
            display: none;
            border-radius: 8px;
            z-index: 60;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
        }

        /* --- SANAL KLAVYE ALANI --- */
        #keyboard-cont {
            width: 100%;
            max-width: 500px;
            padding: 5px 3px var(--safe-bottom) 3px; /* Alttan güvenli boşluk */
            flex-shrink: 0; /* Küçülmesine izin verme */
            background-color: var(--dark);
        }

        .keyboard-row {
            display: flex;
            width: 100%;
            margin: 0 auto 6px; /* Satır boşluğu */
            touch-action: manipulation;
            justify-content: center;
        }

        .keyboard-button {
            font-family: inherit;
            font-weight: bold;
            border: 0;
            margin: 0 2px;
            height: 52px; /* Tuş yüksekliği */
            border-radius: 4px;
            cursor: pointer;
            user-select: none;
            background-color: var(--key-bg);
            color: var(--light);
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            text-transform: uppercase;
            font-size: 0.9rem;
            -webkit-tap-highlight-color: transparent; /* Tıklama efektini kaldır */
        }

        .keyboard-button.wide-button {
            flex: 1.5;
            font-size: 0.75rem;
        }
        
        .key-correct { background-color: var(--green) !important; color: white; }
        .key-present { background-color: var(--yellow) !important; color: white; }
        .key-absent { background-color: #3a3a3c !important; }

        /* Küçük ekranlar için medya sorgusu */
        @media (max-height: 650px) {
            .tile { font-size: 1.4rem; }
            .keyboard-button { height: 45px; font-size: 0.8rem; }
            h1 { font-size: 1.2rem; }
            #game-board { gap: 3px; }
        }

    </style>
</head>
<body>

    <header>
        <h1>KELİME BULMACA</h1>
        <div class="info-bar">
            <span id="level-info">LVL: 1 (3 HARF)</span>
            <span>|</span>
            <span id="category-info">KAT: HAYVAN</span>
            <span>|</span>
            <span id="stamina-info">HAK: 4</span>
        </div>
    </header>

    <div id="message-area"></div>
    <button id="restart-btn" onclick="nextLevelOrRestart()">Sonraki Seviye</button>

    <div id="game-container">
        <div id="game-board"></div>
    </div>

    <div id="keyboard-cont"></div>

    <script>
        // --- AYARLAR VE KELİME HAVUZU ---
        const GAME_DATA = {
            3: { 
                category: "HAYVAN", 
                words: ["KUS", "AYI", "ARI", "FIL", "FOK", "KAZ", "BIT", "KOC"] 
            },
            4: { 
                category: "ULKE", 
                words: ["IRAN", "IRAK", "KUBA", "PERU", "SILI", "LAOS", "MALI", "FIJI", "TOGO", "GANA", "GINE"] 
            },
            5: { 
                category: "SEHIR (TR)", 
                words: ["MUGLA", "IZMIR", "SINOP", "CORUM", "SIIRT", "SIVAS", "AYDIN", "BURSA", "DUZCE", "KILIS", "IGDIR", "TOKAT", "KONYA", "NIGDE", "ADANA", "HATAY"] 
            },
            6: { 
                category: "BITKI", 
                words: ["AKASYA", "ANASON", "ARIOTU", "CAKSIR", "KUSOTU", "GURGEN", "CAVDAR", "HUNNAP", "ANANAS", "KAMKAT", "KAYISI", "KARPUZ", "TURUNC", "MUSKAT", "ALABAS", "PANCAR", "PIRASA", "SALGAM", "HASHAS", "KISNIS", "KIMYON", "LAHANA", "MURVER", "MAHLEP", "REZENE", "SUTOTU", "SARIOT", "SIMSIR", "CIGDEM", "DISOTU", "KAKTUS", "KIZOTU", "LEYLAK", "NERGIS", "ORKIDE", "REYHAN", "ZAKKUM", "ZAMBAK", "CELTIK", "FISTIK", "FINDIK", "HARDAL", "PIRINC", "SAFRAN", "ZEYTIN", "KAKULE", "JOJOBA", "LILYUM"] 
            }
        };

        // --- GLOBAL DEĞİŞKENLER ---
        let currentTour = 3; 
        let maxAttempts = 0;
        let currentAttempt = 0;
        let targetWord = "";
        let currentGuess = "";
        let gameOver = false;
        let gameBoard = document.getElementById("game-board");

        // --- BAŞLATMA ---
        window.onload = function() {
            initKeyboard(); 
            startGame(currentTour);
            
            // Fiziksel klavye desteği
            document.addEventListener("keydown", (e) => {
                if(gameOver) return;
                let key = e.key;
                if (key === "Enter") handleVirtualKey("ENTER");
                else if (key === "Backspace") handleVirtualKey("SIL");
                else if (key.length === 1 && key.match(/[a-zA-ZğüşıöçĞÜŞİÖÇ]/)) handleVirtualKey(key.toLocaleUpperCase('tr-TR'));
            });
        };

        function initKeyboard() {
            const keys = [
                "E R T Y U I O P Ğ Ü",
                "A S D F G H J K L Ş İ",
                "ENTER Z X C V B N M Ö Ç SIL"
            ];
            
            const keyboardCont = document.getElementById("keyboard-cont");
            keyboardCont.innerHTML = ""; 

            keys.forEach(rowString => {
                let rowDiv = document.createElement("div");
                rowDiv.classList.add("keyboard-row");
                
                let chars = rowString.split(" ");
                
                chars.forEach(char => {
                    let btn = document.createElement("button");
                    btn.classList.add("keyboard-button");
                    
                    if(char === "SIL") {
                        btn.innerHTML = "&#9003;"; // Silme ikonu
                        btn.classList.add("wide-button");
                    } else if (char === "ENTER") {
                        btn.innerText = "ENTER";
                        btn.classList.add("wide-button");
                    } else {
                        btn.innerText = char;
                    }

                    btn.setAttribute("data-key", char); 

                    btn.addEventListener("click", (e) => {
                        e.preventDefault(); // Butonun focus almasını engelle
                        handleVirtualKey(char);
                    });

                    rowDiv.appendChild(btn);
                });

                keyboardCont.appendChild(rowDiv);
            });
        }

        function handleVirtualKey(key) {
            if (gameOver) return;

            if (key === "ENTER") {
                submitGuess();
            } else if (key === "SIL") {
                if(currentGuess.length > 0) {
                    currentGuess = currentGuess.slice(0, -1);
                    updateActiveRow();
                }
            } else {
                if (currentGuess.length < currentTour) {
                    currentGuess += key;
                    updateActiveRow();
                }
            }
        }

        function startGame(tour) {
            if (tour > 6) {
                showMessage("TEBRİKLER! OYUN BİTTİ.", 5000);
                document.getElementById("restart-btn").style.display = "none";
                return;
            }

            currentTour = tour;
            currentAttempt = 0;
            currentGuess = "";
            gameOver = false;
            maxAttempts = tour + 1;
            
            const words = GAME_DATA[tour].words;
            targetWord = words[Math.floor(Math.random() * words.length)];
            console.log("Hedef:", targetWord);

            document.getElementById("level-info").innerText = `LVL: ${tour - 2}`;
            document.getElementById("category-info").innerText = `${GAME_DATA[tour].category}`;
            document.getElementById("stamina-info").innerText = `HAK: ${maxAttempts}`;
            document.getElementById("restart-btn").style.display = "none";

            createBoard(tour, maxAttempts);
            resetKeyboardColors(); 
        }

        function createBoard(width, height) {
            // CSS Grid yapısını güncelle: Sütun sayısı kadar eşit parça
            gameBoard.style.gridTemplateColumns = `repeat(${width}, 1fr)`;
            
            gameBoard.innerHTML = "";

            for (let i = 0; i < height * width; i++) {
                let box = document.createElement("div");
                box.classList.add("tile");
                box.id = `box-${i}`;
                gameBoard.appendChild(box);
            }
        }

        function updateActiveRow() {
            let rowStart = currentAttempt * currentTour;
            for (let i = 0; i < currentTour; i++) {
                let box = document.getElementById(`box-${rowStart + i}`);
                box.innerText = currentGuess[i] || "";
                
                if (currentGuess[i]) {
                    box.classList.add("filled");
                } else {
                    box.classList.remove("filled");
                }
            }
        }

        function submitGuess() {
            if (currentGuess.length !== currentTour) {
                showMessage("Eksik harf!");
                return;
            }

            const guessResult = checkGuess(currentGuess, targetWord);
            colorizeRow(guessResult);
            updateKeyboardColors(currentGuess, guessResult); 

            if (currentGuess === targetWord) {
                gameOver = true;
                showMessage(`Tebrikler!`, 2000);
                setTimeout(() => {
                    let btn = document.getElementById("restart-btn");
                    btn.innerText = "Sonraki Seviye";
                    btn.style.display = "block";
                }, 1000);
            } else {
                currentAttempt++;
                currentGuess = "";
                document.getElementById("stamina-info").innerText = `HAK: ${maxAttempts - currentAttempt}`;

                if (currentAttempt >= maxAttempts) {
                    gameOver = true;
                    showMessage(`Cevap: ${targetWord}`, 3000);
                    setTimeout(() => {
                        let btn = document.getElementById("restart-btn");
                        btn.innerText = "Tekrar Dene";
                        btn.style.display = "block";
                    }, 1500);
                }
            }
        }

        function checkGuess(guess, target) {
            let result = new Array(guess.length).fill(0); 
            let targetFreq = {};
            
            for (let char of target) {
                targetFreq[char] = (targetFreq[char] || 0) + 1;
            }

            for (let i = 0; i < guess.length; i++) {
                if (guess[i] === target[i]) {
                    result[i] = 1; 
                    targetFreq[guess[i]]--;
                }
            }

            for (let i = 0; i < guess.length; i++) {
                if (result[i] === 0) { 
                    if (targetFreq[guess[i]] > 0) {
                        result[i] = 2; 
                        targetFreq[guess[i]]--;
                    }
                }
            }
            return result;
        }

        function colorizeRow(resultArray) {
            let rowStart = currentAttempt * currentTour;
            for (let i = 0; i < currentTour; i++) {
                let box = document.getElementById(`box-${rowStart + i}`);
                setTimeout(() => {
                    if (resultArray[i] === 1) box.classList.add("correct");
                    else if (resultArray[i] === 2) box.classList.add("present");
                    else box.classList.add("absent");
                }, i * 100); // Küçük bir animasyon gecikmesi
            }
        }

        function updateKeyboardColors(guess, result) {
            for (let i = 0; i < guess.length; i++) {
                let char = guess[i];
                let colorStatus = result[i]; 
                
                let keyBtn = document.querySelector(`button[data-key='${char}']`);
                if (!keyBtn) continue;

                setTimeout(() => {
                    if (colorStatus === 1) {
                        keyBtn.classList.remove("key-present");
                        keyBtn.classList.add("key-correct");
                    } else if (colorStatus === 2 && !keyBtn.classList.contains("key-correct")) {
                        keyBtn.classList.add("key-present");
                    } else if (colorStatus === 0 && !keyBtn.classList.contains("key-correct") && !keyBtn.classList.contains("key-present")) {
                        keyBtn.classList.add("key-absent");
                    }
                }, guess.length * 100);
            }
        }

        function resetKeyboardColors() {
            let keys = document.querySelectorAll(".keyboard-button");
            keys.forEach(k => {
                k.classList.remove("key-correct", "key-present", "key-absent");
            });
        }

        function showMessage(msg, duration = 2000) {
            const el = document.getElementById("message-area");
            el.innerText = msg;
            el.style.display = "block";
            
            setTimeout(() => {
                el.style.display = "none";
            }, duration);
        }

        function nextLevelOrRestart() {
            const btnText = document.getElementById("restart-btn").innerText;
            if (btnText === "Sonraki Seviye") {
                currentTour++;
                startGame(currentTour);
            } else {
                startGame(currentTour);
            }
        }
    </script>
</body>
</html>
